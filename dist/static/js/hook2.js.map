{"version":3,"file":"hook2.js","sources":["../../../src/views/system/role/utils/hook.tsx"],"sourcesContent":["import dayjs from \"dayjs\";\nimport editForm from \"../form.vue\";\nimport { message } from \"@/utils/message\";\nimport { getRoleList } from \"@/api/system\";\nimport { ElMessageBox } from \"element-plus\";\nimport { usePublicHooks } from \"../../hooks\";\nimport { addDialog } from \"@/components/ReDialog\";\nimport { type FormItemProps } from \"../utils/types\";\nimport { type PaginationProps } from \"@pureadmin/table\";\nimport { reactive, ref, onMounted, h, toRaw } from \"vue\";\n\nexport function useRole() {\n  const form = reactive({\n    name: \"\",\n    code: \"\",\n    status: \"\"\n  });\n  const formRef = ref();\n  const dataList = ref([]);\n  const loading = ref(true);\n  const switchLoadMap = ref({});\n  const { switchStyle } = usePublicHooks();\n  const pagination = reactive<PaginationProps>({\n    total: 0,\n    pageSize: 10,\n    currentPage: 1,\n    background: true\n  });\n  const columns: TableColumnList = [\n    {\n      label: \"角色编号\",\n      prop: \"id\",\n      minWidth: 100\n    },\n    {\n      label: \"角色名称\",\n      prop: \"name\",\n      minWidth: 120\n    },\n    {\n      label: \"角色标识\",\n      prop: \"code\",\n      minWidth: 150\n    },\n    {\n      label: \"状态\",\n      minWidth: 130,\n      cellRenderer: scope => (\n        <el-switch\n          size={scope.props.size === \"small\" ? \"small\" : \"default\"}\n          loading={switchLoadMap.value[scope.index]?.loading}\n          v-model={scope.row.status}\n          active-value={1}\n          inactive-value={0}\n          active-text=\"已启用\"\n          inactive-text=\"已停用\"\n          inline-prompt\n          style={switchStyle.value}\n          onChange={() => onChange(scope as any)}\n        />\n      )\n    },\n    {\n      label: \"备注\",\n      prop: \"remark\",\n      minWidth: 150\n    },\n    {\n      label: \"创建时间\",\n      minWidth: 180,\n      prop: \"createTime\",\n      formatter: ({ createTime }) =>\n        dayjs(createTime).format(\"YYYY-MM-DD HH:mm:ss\")\n    },\n    {\n      label: \"操作\",\n      fixed: \"right\",\n      width: 240,\n      slot: \"operation\"\n    }\n  ];\n  // const buttonClass = computed(() => {\n  //   return [\n  //     \"!h-[20px]\",\n  //     \"reset-margin\",\n  //     \"!text-gray-500\",\n  //     \"dark:!text-white\",\n  //     \"dark:hover:!text-primary\"\n  //   ];\n  // });\n\n  function onChange({ row, index }) {\n    ElMessageBox.confirm(\n      `确认要<strong>${\n        row.status === 0 ? \"停用\" : \"启用\"\n      }</strong><strong style='color:var(--el-color-primary)'>${\n        row.name\n      }</strong>吗?`,\n      \"系统提示\",\n      {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\",\n        dangerouslyUseHTMLString: true,\n        draggable: true\n      }\n    )\n      .then(() => {\n        switchLoadMap.value[index] = Object.assign(\n          {},\n          switchLoadMap.value[index],\n          {\n            loading: true\n          }\n        );\n        setTimeout(() => {\n          switchLoadMap.value[index] = Object.assign(\n            {},\n            switchLoadMap.value[index],\n            {\n              loading: false\n            }\n          );\n          message(`已${row.status === 0 ? \"停用\" : \"启用\"}${row.name}`, {\n            type: \"success\"\n          });\n        }, 300);\n      })\n      .catch(() => {\n        row.status === 0 ? (row.status = 1) : (row.status = 0);\n      });\n  }\n\n  function handleDelete(row) {\n    message(`您删除了角色名称为${row.name}的这条数据`, { type: \"success\" });\n    onSearch();\n  }\n\n  function handleSizeChange(val: number) {\n    console.log(`${val} items per page`);\n  }\n\n  function handleCurrentChange(val: number) {\n    console.log(`current page: ${val}`);\n  }\n\n  function handleSelectionChange(val) {\n    console.log(\"handleSelectionChange\", val);\n  }\n\n  async function onSearch() {\n    loading.value = true;\n    const { data } = await getRoleList(toRaw(form));\n    dataList.value = data.list;\n    pagination.total = data.total;\n    pagination.pageSize = data.pageSize;\n    pagination.currentPage = data.currentPage;\n\n    setTimeout(() => {\n      loading.value = false;\n    }, 500);\n  }\n\n  const resetForm = formEl => {\n    if (!formEl) return;\n    formEl.resetFields();\n    onSearch();\n  };\n\n  function openDialog(title = \"新增\", row?: FormItemProps) {\n    addDialog({\n      title: `${title}角色`,\n      props: {\n        formInline: {\n          name: row?.name ?? \"\",\n          code: row?.code ?? \"\",\n          remark: row?.remark ?? \"\"\n        }\n      },\n      width: \"40%\",\n      draggable: true,\n      fullscreenIcon: true,\n      closeOnClickModal: false,\n      contentRenderer: () => h(editForm, { ref: formRef }),\n      beforeSure: (done, { options }) => {\n        const FormRef = formRef.value.getRef();\n        const curData = options.props.formInline as FormItemProps;\n        function chores() {\n          message(`您${title}了角色名称为${curData.name}的这条数据`, {\n            type: \"success\"\n          });\n          done(); // 关闭弹框\n          onSearch(); // 刷新表格数据\n        }\n        FormRef.validate(valid => {\n          if (valid) {\n            console.log(\"curData\", curData);\n            // 表单规则校验通过\n            if (title === \"新增\") {\n              // 实际开发先调用新增接口，再进行下面操作\n              chores();\n            } else {\n              // 实际开发先调用编辑接口，再进行下面操作\n              chores();\n            }\n          }\n        });\n      }\n    });\n  }\n\n  /** 菜单权限 */\n  function handleMenu() {\n    message(\"等菜单管理页面开发后完善\");\n  }\n\n  /** 数据权限 可自行开发 */\n  // function handleDatabase() {}\n\n  onMounted(() => {\n    onSearch();\n  });\n\n  return {\n    form,\n    loading,\n    columns,\n    dataList,\n    pagination,\n    // buttonClass,\n    onSearch,\n    resetForm,\n    openDialog,\n    handleMenu,\n    handleDelete,\n    // handleDatabase,\n    handleSizeChange,\n    handleCurrentChange,\n    handleSelectionChange\n  };\n}\n"],"names":["useRole","form","reactive","name","code","status","formRef","ref","dataList","loading","switchLoadMap","switchStyle","usePublicHooks","pagination","total","pageSize","currentPage","background","columns","label","prop","minWidth","cellRenderer","scope","_createVNode","_resolveComponent","props","size","value","index","row","$event","onChange","formatter","createTime","dayjs","format","fixed","width","slot","ElMessageBox","confirm","confirmButtonText","cancelButtonText","type","dangerouslyUseHTMLString","draggable","then","Object","assign","setTimeout","message","catch","handleDelete","onSearch","handleSizeChange","val","console","handleCurrentChange","handleSelectionChange","log","getRoleList","toRaw","data","openDialog","title","resetForm","addDialog","formInline","remark","h","editForm","done","fullscreenIcon","closeOnClickModal","contentRenderer","chores","beforeSure","curData","options","FormRef","valid","handleMenu","onMounted"],"mappings":"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"}