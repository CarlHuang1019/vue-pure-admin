{"version":3,"file":"index17.js","sources":["../../../src/components/ReSelector/src/index.tsx","../../../src/components/ReSelector/index.ts","../../../src/views/components/selector/index.vue"],"sourcesContent":["import {\n  defineComponent,\n  computed,\n  nextTick,\n  onBeforeMount,\n  getCurrentInstance,\n  unref\n} from \"vue\";\nimport { addClass, removeClass, toggleClass } from \"@pureadmin/utils\";\nimport \"./index.css\";\n\nconst stayClass = \"stay\"; //鼠标点击\nconst activeClass = \"hs-on\"; //鼠标移动上去\nconst voidClass = \"hs-off\"; //鼠标移开\nconst inRange = \"hs-range\"; //当前选中的两个元素之间的背景\nconst bothLeftSides = \"both-left-sides\";\nconst bothRightSides = \"both-right-sides\";\nlet selectedDirection = \"right\"; //默认从左往右，索引变大\n\nlet overList = [];\n// 存放第一个选中的元素和最后一个选中元素，只能存放这两个元素\nlet selectedList = [];\n\nconst props = {\n  HsKey: {\n    type: Number || String,\n    default: 0\n  },\n  disabled: {\n    type: Boolean,\n    default: false\n  },\n  value: {\n    type: Number,\n    default: 0\n  },\n  max: {\n    type: Array,\n    default() {\n      return [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];\n    }\n  },\n  // 回显数据的索引，长度必须是2\n  echo: {\n    type: Array,\n    default() {\n      return [];\n    }\n  }\n};\n\nexport default defineComponent({\n  name: \"ReSelector\",\n  props,\n  emits: [\"selectedVal\"],\n  setup(props, { emit }) {\n    const instance = getCurrentInstance();\n    // eslint-disable-next-line vue/no-setup-props-destructure\n    const currentValue = props.value;\n\n    const rateDisabled = computed(() => {\n      return props.disabled;\n    });\n\n    const classes = computed(() => {\n      const result = [];\n      let i = 0;\n      let threshold = currentValue;\n      if (currentValue !== Math.floor(currentValue)) {\n        threshold--;\n      }\n      for (; i < threshold; i++) {\n        result.push(activeClass);\n      }\n      for (; i < props.max.length; i++) {\n        result.push(voidClass);\n      }\n      return result;\n    });\n\n    // 鼠标移入\n    const setCurrentValue = index => {\n      if (props.disabled) return;\n      // 当选中一个元素后，开始添加背景色\n      if (selectedList.length === 1) {\n        if (overList.length < 1) overList.push({ index });\n\n        let firstIndex = overList[0].index;\n\n        // 往右走，索引变大\n        if (index > firstIndex) {\n          selectedDirection = \"right\";\n          toggleClass(\n            false,\n            bothRightSides,\n            document.querySelector(\".hs-select__item\" + selectedList[0].index)\n          );\n\n          while (index >= firstIndex) {\n            addClass(\n              document.querySelector(\".hs-select__item\" + firstIndex),\n              inRange\n            );\n            firstIndex++;\n          }\n        } else {\n          selectedDirection = \"left\";\n          toggleClass(\n            true,\n            bothRightSides,\n            document.querySelector(\".hs-select__item\" + selectedList[0].index)\n          );\n\n          while (index <= firstIndex) {\n            addClass(\n              document.querySelector(\".hs-select__item\" + firstIndex),\n              inRange\n            );\n            firstIndex--;\n          }\n        }\n      }\n\n      addClass(document.querySelector(\".\" + voidClass + index), activeClass);\n    };\n\n    // 鼠标离开\n    const resetCurrentValue = index => {\n      if (props.disabled) return;\n      // 移除先检查是否选中 选中则返回false 不移除\n      const currentHsDom = document.querySelector(\".\" + voidClass + index);\n      if (currentHsDom.className.includes(stayClass)) {\n        return false;\n      } else {\n        removeClass(currentHsDom, activeClass);\n      }\n\n      // 当选中一个元素后，开始移除背景色\n      if (selectedList.length === 1) {\n        const firstIndex = overList[0].index;\n        if (index >= firstIndex) {\n          for (let i = 0; i <= index; i++) {\n            removeClass(\n              document.querySelector(\".hs-select__item\" + i),\n              inRange\n            );\n          }\n        } else {\n          while (index <= firstIndex) {\n            removeClass(\n              document.querySelector(\".hs-select__item\" + index),\n              inRange\n            );\n            index++;\n          }\n        }\n      }\n    };\n\n    // 鼠标点击\n    const selectValue = (index, item) => {\n      if (props.disabled) return;\n      const len = selectedList.length;\n\n      if (len < 2) {\n        selectedList.push({ item, index });\n        addClass(document.querySelector(\".\" + voidClass + index), stayClass);\n\n        addClass(\n          document.querySelector(\".hs-select__item\" + selectedList[0].index),\n          bothLeftSides\n        );\n\n        if (selectedList[1]) {\n          if (selectedDirection === \"right\") {\n            addClass(\n              document.querySelector(\n                \".hs-select__item\" + selectedList[1].index\n              ),\n              bothRightSides\n            );\n          } else {\n            addClass(\n              document.querySelector(\n                \".hs-select__item\" + selectedList[1].index\n              ),\n              bothLeftSides\n            );\n          }\n        }\n\n        if (len === 1) {\n          // 顺时针排序\n          if (selectedDirection === \"right\") {\n            emit(\"selectedVal\", {\n              left: selectedList[0].item,\n              right: selectedList[1].item,\n              whole: selectedList\n            });\n          } else {\n            emit(\"selectedVal\", {\n              left: selectedList[1].item,\n              right: selectedList[0].item,\n              whole: selectedList\n            });\n          }\n        }\n      } else {\n        nextTick(() => {\n          selectedList.forEach(v => {\n            removeClass(\n              document.querySelector(\".\" + voidClass + v.index),\n              activeClass,\n              stayClass\n            );\n\n            removeClass(\n              document.querySelector(\".hs-select__item\" + v.index),\n              bothLeftSides,\n              bothRightSides\n            );\n          });\n\n          selectedList = [];\n          overList = [];\n          for (let i = 0; i <= props.max.length; i++) {\n            const currentDom = document.querySelector(\".hs-select__item\" + i);\n            if (currentDom) {\n              removeClass(currentDom, inRange);\n            }\n          }\n\n          selectedList.push({ item, index });\n          addClass(document.querySelector(\".\" + voidClass + index), stayClass);\n\n          addClass(\n            document.querySelector(\".hs-select__item\" + selectedList[0].index),\n            bothLeftSides\n          );\n        });\n      }\n    };\n\n    // 回显数据\n    const echoView = item => {\n      if (item.length === 0) return;\n\n      if (item.length > 2 || item.length === 1) {\n        throw \"传入的数组长度必须是2\";\n      }\n\n      item.sort((a, b) => {\n        return a - b;\n      });\n\n      addClass(\n        instance.refs[\"hsdiv\" + props.HsKey + item[0]] as Element,\n        activeClass,\n        stayClass\n      );\n\n      addClass(\n        instance.refs[\"hstd\" + props.HsKey + item[0]] as Element,\n        bothLeftSides\n      );\n\n      addClass(\n        instance.refs[\"hsdiv\" + props.HsKey + item[1]] as Element,\n        activeClass,\n        stayClass\n      );\n\n      addClass(\n        instance.refs[\"hstd\" + props.HsKey + item[1]] as Element,\n        bothRightSides\n      );\n\n      while (item[1] >= item[0]) {\n        addClass(\n          instance.refs[\"hstd\" + props.HsKey + item[0]] as Element,\n          inRange\n        );\n        item[0]++;\n      }\n    };\n\n    onBeforeMount(() => {\n      nextTick(() => {\n        echoView(props.echo);\n      });\n    });\n\n    return () => (\n      <>\n        <table cellspacing=\"0\" cellpadding=\"0\">\n          <tbody>\n            <tr>\n              {props.max.map((item, key) => {\n                return (\n                  <td\n                    data-index={props.HsKey}\n                    ref={`hstd${props.HsKey}${key}`}\n                    class={`hs-select__item${key}`}\n                    onMousemove={() => setCurrentValue(key)}\n                    onMouseleave={() => resetCurrentValue(key)}\n                    onClick={() => selectValue(key, item)}\n                    style={{\n                      cursor: unref(rateDisabled) ? \"auto\" : \"pointer\",\n                      textAlign: \"center\"\n                    }}\n                    key={key}\n                  >\n                    <div\n                      ref={`hsdiv${props.HsKey}${key}`}\n                      class={`hs-item ${[unref(classes)[key] + key]}`}\n                    >\n                      <span>{item}</span>\n                    </div>\n                  </td>\n                );\n              })}\n            </tr>\n          </tbody>\n        </table>\n      </>\n    );\n  }\n});\n","import reSelector from \"./src\";\nimport { withInstall } from \"@pureadmin/utils\";\n\n/** 选择器组件 */\nexport const ReSelector = withInstall(reSelector);\n\nexport default ReSelector;\n","<script setup lang=\"ts\">\nimport { ref } from \"vue\";\nimport Selector from \"@/components/ReSelector\";\n\ndefineOptions({\n  name: \"Selector\"\n});\n\nconst selectRange = ref<string>(\"\");\nconst dataLists = ref([\n  {\n    title: \"基本使用\",\n    echo: [],\n    disabled: false\n  },\n  {\n    title: \"回显模式\",\n    echo: [2, 7],\n    disabled: true\n  }\n]);\n\nconst selectedVal = ({ left, right }): void => {\n  selectRange.value = `${left}-${right}`;\n};\n</script>\n\n<template>\n  <div>\n    <el-card\n      class=\"box-card\"\n      v-for=\"(item, key) in dataLists\"\n      :key=\"key\"\n      shadow=\"never\"\n    >\n      <template #header>\n        <div class=\"card-header\">\n          <span>{{ item.title }}</span>\n        </div>\n      </template>\n      <Selector\n        :HsKey=\"key\"\n        :echo=\"item.echo\"\n        @selectedVal=\"selectedVal\"\n        :disabled=\"item.disabled\"\n      />\n      <h4 class=\"mt-3\" v-if=\"!item.disabled\">选中范围：{{ selectRange }}</h4>\n    </el-card>\n  </div>\n</template>\n\n<style scoped>\n.el-card {\n  margin-bottom: 10px;\n}\n</style>\n"],"names":["stayClass","activeClass","voidClass","inRange","bothLeftSides","bothRightSides","selectedDirection","overList","selectedList","props","HsKey","type","Number","String","default","disabled","Boolean","value","max","Array","echo","defineComponent","name","emits","setup","emit","instance","getCurrentInstance","currentValue","rateDisabled","computed","classes","result","i","threshold","Math","floor","push","length","setCurrentValue","index","firstIndex","toggleClass","document","querySelector","addClass","resetCurrentValue","currentHsDom","className","includes","removeClass","selectValue","item","len","left","right","whole","nextTick","forEach","v","currentDom","echoView","sort","a","b","refs","onBeforeMount","_createVNode","_Fragment","map","key","onMousemove","onMouseleave","onClick","cursor","unref","textAlign","ReSelector","withInstall","reSelector","selectRange","ref","dataLists","selectedVal"],"mappings":"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"}