{"version":3,"file":"print2.js","sources":["../../../src/utils/print.ts"],"sourcesContent":["interface PrintFunction {\n  extendOptions: Function;\n  getStyle: Function;\n  setDomHeight: Function;\n  toPrint: Function;\n}\n\nconst Print = function (dom, options?: object): PrintFunction {\n  options = options || {};\n  // @ts-expect-error\n  if (!(this instanceof Print)) return new Print(dom, options);\n  this.conf = {\n    styleStr: \"\",\n    // Elements that need to dynamically get and set the height\n    setDomHeightArr: [],\n    // Callback before printing\n    printBeforeFn: null,\n    // Callback after printing\n    printDoneCallBack: null\n  };\n  for (const key in this.conf) {\n    // eslint-disable-next-line no-prototype-builtins\n    if (key && options.hasOwnProperty(key)) {\n      this.conf[key] = options[key];\n    }\n  }\n  if (typeof dom === \"string\") {\n    this.dom = document.querySelector(dom);\n  } else {\n    this.dom = this.isDOM(dom) ? dom : dom.$el;\n  }\n  if (this.conf.setDomHeightArr && this.conf.setDomHeightArr.length) {\n    this.setDomHeight(this.conf.setDomHeightArr);\n  }\n  this.init();\n};\n\nPrint.prototype = {\n  /**\n   * init\n   */\n  init: function (): void {\n    const content = this.getStyle() + this.getHtml();\n    this.writeIframe(content);\n  },\n  /**\n   * Configuration property extension\n   * @param {Object} obj\n   * @param {Object} obj2\n   */\n  extendOptions: function <T>(obj, obj2: T): T {\n    for (const k in obj2) {\n      obj[k] = obj2[k];\n    }\n    return obj;\n  },\n  /**\n    Copy all styles of the original page\n  */\n  getStyle: function (): string {\n    let str = \"\";\n    const styles: NodeListOf<Element> = document.querySelectorAll(\"style,link\");\n    for (let i = 0; i < styles.length; i++) {\n      str += styles[i].outerHTML;\n    }\n    str += `<style>.no-print{display:none;}${this.conf.styleStr}</style>`;\n    return str;\n  },\n  // form assignment\n  getHtml: function (): Element {\n    const inputs = document.querySelectorAll(\"input\");\n    const selects = document.querySelectorAll(\"select\");\n    const textareas = document.querySelectorAll(\"textarea\");\n    const canvass = document.querySelectorAll(\"canvas\");\n\n    for (let k = 0; k < inputs.length; k++) {\n      if (inputs[k].type == \"checkbox\" || inputs[k].type == \"radio\") {\n        if (inputs[k].checked == true) {\n          inputs[k].setAttribute(\"checked\", \"checked\");\n        } else {\n          inputs[k].removeAttribute(\"checked\");\n        }\n      } else if (inputs[k].type == \"text\") {\n        inputs[k].setAttribute(\"value\", inputs[k].value);\n      } else {\n        inputs[k].setAttribute(\"value\", inputs[k].value);\n      }\n    }\n\n    for (let k2 = 0; k2 < textareas.length; k2++) {\n      if (textareas[k2].type == \"textarea\") {\n        textareas[k2].innerHTML = textareas[k2].value;\n      }\n    }\n\n    for (let k3 = 0; k3 < selects.length; k3++) {\n      if (selects[k3].type == \"select-one\") {\n        const child = selects[k3].children;\n        for (const i in child) {\n          if (child[i].tagName == \"OPTION\") {\n            if ((child[i] as any).selected == true) {\n              child[i].setAttribute(\"selected\", \"selected\");\n            } else {\n              child[i].removeAttribute(\"selected\");\n            }\n          }\n        }\n      }\n    }\n\n    for (let k4 = 0; k4 < canvass.length; k4++) {\n      const imageURL = canvass[k4].toDataURL(\"image/png\");\n      const img = document.createElement(\"img\");\n      img.src = imageURL;\n      img.setAttribute(\"style\", \"max-width: 100%;\");\n      img.className = \"isNeedRemove\";\n      canvass[k4].parentNode.insertBefore(img, canvass[k4].nextElementSibling);\n    }\n\n    return this.dom.outerHTML;\n  },\n  /**\n    create iframe\n  */\n  writeIframe: function (content) {\n    let w: Document | Window;\n    let doc: Document;\n    const iframe: HTMLIFrameElement = document.createElement(\"iframe\");\n    const f: HTMLIFrameElement = document.body.appendChild(iframe);\n    iframe.id = \"myIframe\";\n    iframe.setAttribute(\n      \"style\",\n      \"position:absolute;width:0;height:0;top:-10px;left:-10px;\"\n    );\n    // eslint-disable-next-line prefer-const\n    w = f.contentWindow || f.contentDocument;\n    // eslint-disable-next-line prefer-const\n    doc = f.contentDocument || f.contentWindow.document;\n    doc.open();\n    doc.write(content);\n    doc.close();\n\n    const removes = document.querySelectorAll(\".isNeedRemove\");\n    for (let k = 0; k < removes.length; k++) {\n      removes[k].parentNode.removeChild(removes[k]);\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const _this = this;\n    iframe.onload = function (): void {\n      // Before popping, callback\n      if (_this.conf.printBeforeFn) {\n        _this.conf.printBeforeFn({ doc });\n      }\n      _this.toPrint(w);\n      setTimeout(function () {\n        document.body.removeChild(iframe);\n        // After popup, callback\n        if (_this.conf.printDoneCallBack) {\n          _this.conf.printDoneCallBack();\n        }\n      }, 100);\n    };\n  },\n  /**\n    Print\n  */\n  toPrint: function (frameWindow): void {\n    try {\n      setTimeout(function () {\n        frameWindow.focus();\n        try {\n          if (!frameWindow.document.execCommand(\"print\", false, null)) {\n            frameWindow.print();\n          }\n        } catch (e) {\n          frameWindow.print();\n        }\n        frameWindow.close();\n      }, 10);\n    } catch (err) {\n      console.error(err);\n    }\n  },\n  isDOM:\n    typeof HTMLElement === \"object\"\n      ? function (obj) {\n          return obj instanceof HTMLElement;\n        }\n      : function (obj) {\n          return (\n            obj &&\n            typeof obj === \"object\" &&\n            obj.nodeType === 1 &&\n            typeof obj.nodeName === \"string\"\n          );\n        },\n  /**\n   * Set the height of the specified dom element by getting the existing height of the dom element and setting\n   * @param {Array} arr\n   */\n  setDomHeight(arr) {\n    if (arr && arr.length) {\n      arr.forEach(name => {\n        const domArr = document.querySelectorAll(name);\n        domArr.forEach(dom => {\n          dom.style.height = dom.offsetHeight + \"px\";\n        });\n      });\n    }\n  }\n};\n\nexport default Print;\n"],"names":["Print","dom","options","key","content","obj","obj2","k","str","styles","i","inputs","selects","textareas","canvass","k2","k3","child","k4","imageURL","img","w","doc","iframe","f","removes","_this","frameWindow","err","arr","name"],"mappings":"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"}